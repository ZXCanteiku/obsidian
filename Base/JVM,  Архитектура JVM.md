## JVM

aliases: 
	- "JVM"

**Java Virtual Machine (JVM)** — это виртуальная машина, которая предоставляет среду для выполнения Java-программ, обеспечивая переносимость кода между разными операционными системами и платформами. JVM превращает Java-байт-код (компилированный код) в машинный код, который может выполняться на любом устройстве, на котором установлена JVM. Архитектура JVM включает в себя несколько ключевых компонентов, каждый из которых играет роль в выполнении и оптимизации Java-приложений.
![Javaworld > Серия статей о JVM / JDK / JRE > Виртуальная машина Java > Обзор](https://images.idgesg.net/images/article/2019/03/javaworld_jvm_jdk_jre_explainer_java_virtual_machine_debug_and_optimize_3x2_overview_update-100790558-large.jpg?auto=webp&quality=85,70)

- **Техническое определение**: JVM — это спецификация для программного обеспечения, которое выполняет код и предоставляет среду выполнения для этого кода.
- **Обычное определение**: JVM — это то, как мы запускаем наши программы на Java. Мы настраиваем параметры, а затем полагаемся на JVM в управлении ресурсами программы во время выполнения.


### **Основные компоненты архитектуры JVM:**
#### 1. **Class Loader (Загрузчик классов)**

- **Функция**: Отвечает за загрузку, проверку и связывание классов, а также их подготовку к исполнению. Каждый загружаемый класс загружается единожды и хранится в памяти для повторного использования.
- **Этапы загрузки**:
    - **Loading**: Загрузчик классов загружает файл `.class` из системы.
    - **Linking**: Проверяет байт-код на корректность (Verify), выделяет память (Prepare) и устанавливает связи с другими загруженными классами (Resolve).
    - **Initialization**: Инициализирует статические переменные и выполняет статические блоки, после чего класс готов к использованию.
- **Примеры загрузчиков классов**: Bootstrap Loader, Extension Class Loader, Application Class Loader.

#### 2. **Runtime Data Area (Области данных во время исполнения)**

JVM управляет несколькими ключевыми областями памяти, которые делятся на:

- **Heap (Куча)**:
    - Основная область памяти для хранения объектов и данных, доступных всем потокам. Все объекты, которые создаются во время работы программы, хранятся в куче.
    - Разделяется на **молодежную область (Young Generation)** и **старую область (Old Generation)** для оптимизации сборки мусора.
- **Stack (Стек)**:
    - Стековая память выделяется каждому потоку при его создании и используется для хранения информации о методах, таких как вызовы, параметры, локальные переменные и возвращаемые значения.
    - Каждый вызов метода создает новый фрейм в стеке, который удаляется после завершения метода.
- **Method Area (Область методов)**:
    - Хранит данные о классах, таких как константы, полиморфные вызовы методов, и используется всеми потоками. Это своего рода библиотека всех загруженных классов и методов.
- **PC Register (Регистры счетчиков программ)**:
    - Каждый поток имеет свой собственный счетчик, который отслеживает выполнение инструкций.
- **Native Method Stack (Стек нативных методов)**:
    - Хранит инструкции для нативных методов, написанных на других языках (например, C или C++), которые могут вызываться из Java.

#### 3. **Execution Engine (Исполнительный движок)**

- **Функция**: Отвечает за выполнение байт-кода, преобразуя его в машинный код, который может быть выполнен на уровне аппаратного обеспечения.
- Состоит из трех основных компонентов:
    - **Interpreter (Интерпретатор)**: Последовательно выполняет инструкции байт-кода. Медленнее, чем компиляция, но позволяет JVM быстрее начать выполнение программы.
    - **JIT Compiler (Just-In-Time компилятор)**: Для оптимизации JIT компилирует наиболее часто исполняемый байт-код в машинный код на лету, ускоряя выполнение.
    - **Garbage Collector (Сборщик мусора)**: Освобождает память, удаляя объекты, которые больше не используются. JVM поддерживает различные алгоритмы сборки мусора (например, G1, Parallel GC, ZGC).

#### 4. **Native Method Interface (Интерфейс нативных методов, JNI)**

- JNI позволяет JVM вызывать нативный код, написанный на языках, отличных от Java, таких как C или C++. Это особенно полезно для взаимодействия с системными ресурсами или сторонними библиотеками, которые не реализованы на Java.
- **Пример использования**: JNI позволяет программам Java работать с библиотеками, специфичными для операционной системы, обеспечивая доступ к драйверам и аппаратным ресурсам.

#### 5. **Native Method Libraries (Библиотеки нативных методов)**

- Это набор библиотек, к которым JVM обращается через JNI. Эти библиотеки поддерживают операции ввода-вывода, сетевые функции и другие функции, доступные на уровне системы.

### Выполнение программы JVM:
- **Компиляция**: Программа компилируется компилятором Java (`javac`) в байт-код, который записывается в файл с расширением `.class`.
- **Загрузка классов**: Загрузчик классов загружает байт-код в память и проверяет его на корректность.
- **Создание и инициализация объектов**: После загрузки классов, объекты создаются в куче, инициализируются их статические и нестатические поля.
- **Выполнение**: Исполнительный движок интерпретирует и компилирует (JIT) байт-код для выполнения. JIT компилирует горячие участки кода в машинный код, ускоряя выполнение.
- [[Garbage Colector]]: Во время выполнения сборщик мусора освобождает неиспользуемые объекты, возвращая память в кучу.
---
Tags: #JVM
Author: [[]]
Related: [[Java Core]]
URL: [[]]