## Журнал скользящих интервалов
aliases: 
	- "Журнал скользящих интервалов"

---

### # Журнал скользящих интервалов

Как уже упоминалось ранее, у **счетчика фиксированных интервалов** есть **проблема**: на границах интервала **может быть принято больше запросов, чем положено**.

### Решение: журнал скользящих интервалов

Алгоритм **журнала скользящих интервалов** помогает решить эту проблему следующим образом:

1. **Система отслеживает временные метки запросов** и хранит их в кэше (например, в **упорядоченных множествах Redis [8]**).
2. **При поступлении нового запроса**:
    - Все **устаревшие запросы** (до начала текущего временного интервала) **удаляются**.
    - Временная метка нового запроса **записывается в журнал**.
3. Если **количество записей в журнале** не превышает **допустимое значение**, **запрос принимается**, иначе — **отклоняется**.

### Пример работы

На **[рис. 4.10]** показана работа алгоритма, где система допускает **не более 2 запросов в минуту**:

1. **В 1:00:01** приходит первый запрос. Журнал **пуст**, поэтому **запрос принимается**.
2. **В 1:00:30** поступает второй запрос, метка **1:00:30** записывается в журнал. Размер журнала теперь **2**, что **не превышает лимит** – **запрос принимается**.
3. **В 1:00:50** приходит третий запрос, метка **1:00:50** записывается в журнал. Теперь **размер журнала = 3**, что **превышает лимит**, поэтому **запрос отклоняется**, но временная метка остается в журнале.
4. **В 1:01:40** поступает новый запрос. Все **устаревшие временные метки** (до **1:00:40**) **удаляются** (1:00:01 и 1:00:30). Теперь размер журнала **снова равен 2**, поэтому **запрос принимается**.
### Иллюстрация работы алгоритма
![[Pasted image 20250301203141.png]]

## Преимущества и недостатки

### Преимущества

- **Точное ограничение трафика** — на любом скользящем интервале **количество запросов не превышает лимит**.
### Недостатки

- **Высокое потребление памяти** — даже **отклоненные запросы** требуют записи временных меток в журнал.

---
Tags:  #solution
Author: [[]]
Related: [[Rate limit]]
URL: -- 