# backpressure

aliases: 
	- "backpressure"
	- "противодавление"

---
**Противодавление** - это способность потребителя сигнализировать производителю, с какой скоростью выброса он может справиться, чтобы он не перегружался.
Иначе говоря, **потребитель управляет темпом производства**. Например, подписчик может запросить 10 элементов (`request(10)`), обработать их, затем снова запросить следующую порцию. Если же данных приходит больше, чем подписчик может обработать, они будут либо буферизироваться, либо отброшены – в зависимости от стратегии.

Диаграмма обмена данными с backpressure между Service A и Service B (WebFlux поверх TCP): подписчик запрашивает данные порциями, издатель отправляет не более запрошенного
![[Pasted image 20250311212529.png]]

1. Это фреймворк WebFlux, который должным образом заботится о преобразовании логических элементов в байты и обратно и передаче/получении их в/из TCP (сети).
2. Это начало длительной обработки элемента, который запрашивает следующие элементы после завершения задания.
3. Здесь, хотя нет спроса со стороны бизнес-логики, WebFlux ставит в очередь байты, поступающие из сети, без их подтверждения (нет спроса со стороны бизнес-логики).
4. Из-за особенностей управления потоком TCP служба A может по-прежнему отправлять данные в сеть.

Существует несколько стратегий управления backpressure на практике:
- **Управление продуцентом** – регулирование скорости генерации данных под возможности потребителя (например, замедление источника).
- **Буферизация** – временное накопление избыточных элементов в буфере. Полезно кратковременно, но буфер не должен расти безгранично (иначе возможен OOM).
- **Отбрасывание (Dropping)** – пропуск или игнорирование новых элементов, если потребитель не успевает (например, брать каждый n-ный элемент или последние элементы).
- **Последовательная обработка** – выстраивание очереди и обработка элементов строго по мере готовности (в ущерб задержкам, но без потери данных).
- **Агрегация** – объединение или сэмплирование быстрого потока (взять последние значения за период времени).



---
Tags: #backpressure
Author: [[]]
Related: [[Реактивное программирование]]
URL: [[]]