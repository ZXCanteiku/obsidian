## Слияние конкурентно записываемых значений
aliases: 
	- "слияние конкурентно записываемых значений"

---

### Слияние конкурентно записываемых значений

Этот алгоритм предотвращает потерю данных, но требует дополнительных усилий от клиентов. Если операции происходят параллельно, клиентам необходимо объединять конкурентные записи, называемые "сиблингами" в Riak.

Объединение сиблингов напоминает разрешение конфликтов в репликации с несколькими лидерами. Простой вариант — выбрать одно значение по номеру версии или временной метке, но это может привести к потере данных. Поэтому часто требуется более сложная логика в приложении.

В примере с корзиной покупок разумное решение — объединить сиблингов. На рисунке  показаны два конечных значения: [молоко, мука, яйца, бекон] и [яйца, молоко, ветчина]. Объединение даст [молоко, мука, яйца, бекон, ветчина], исключив дубликаты.
![[Pasted image 20241010212218.png]]

Однако при удалении товаров объединение может вернуть удалённый товар. Чтобы этого избежать, при удалении создаётся "надгробие" (tombstone) — специальный маркер, указывающий, что предмет был удалён, и его нужно учитывать при объединении.

Из-за сложности объединения сиблингов вручную, разрабатываются структуры данных, как CRDT, которые автоматически объединяют сиблингов и сохраняют информацию об удалениях.

---
Tags: #highLoad #develop #replication
Author: [[]]
Related: [[Обнаружение конкурентных операций записи]]
URL: -- 