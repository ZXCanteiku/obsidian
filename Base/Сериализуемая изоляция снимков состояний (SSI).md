## Сериализуемая изоляция снимков состояний (SSI)
aliases: 
	- "сериализуемая изоляция снимков состояний (SSI)"

---

### Сериализуемая изоляция снимков состояний (SSI)

Реализации сериализуемости, как правило, либо имеют низкую производительность (например, **[[Двухфазная блокировка (2PL)]]**), либо плохо масштабируются (например, **[[Последовательное выполнение транзакций]]**). В то время как слабые уровни изоляции показывают высокую производительность, они подвержены состояниям гонки, таким как  [[Асимметрия записи и фантомы]]. Может ли сериализуемая изоляция и высокая производительность быть совместимыми? Ответом на это является алгоритм **сериализуемой изоляции снимков состояния (SSI)**, который обеспечивает полную сериализуемость при небольшой потере производительности по сравнению с обычной изоляцией снимков состояния. SSI был впервые описан в 2008 году Майклом Кэхиллом и используется в одноузловых и распределенных базах данных, таких как PostgreSQL и FoundationDB.

**Пессимистическое и оптимистическое управление конкурентным доступом**

- **Двухфазная блокировка** — пример пессимистического подхода. Транзакции блокируют доступ к данным, если есть риск конфликта. Это напоминает использование взаимных исключений в многопоточном программировании. Преимущество — блокировки удерживаются короткое время, но это замедляет систему.
- **Последовательное выполнение** — также пессимистичный метод, когда транзакция удерживает монопольную блокировку на всю базу данных до завершения. Это приводит к максимальной синхронизации, но и снижает производительность.

В отличие от этого, **сериализуемая изоляция снимков состояния (SSI)** — это оптимистичный подход. Транзакции не блокируют данные заранее, а выполняются с надеждой на отсутствие конфликтов. Если конфликт возникает, транзакция прерывается и повторяется. Этот подход подходит для систем с низким уровнем конкуренции, где система не близка к максимальной пропускной способности.

**Основные принципы SSI**

SSI использует изоляцию снимков состояния, то есть все операции чтения выполняются на основе согласованного снимка данных. Однако SSI добавляет механизм для обнаружения конфликтов сериализации, что позволяет прерывать транзакции, которые могут нарушить сериализуемость.

**Проблемы и решения**

1. **Асимметрия записи**: При изоляции снимков состояния данные, считанные в начале транзакции, могут измениться до ее завершения. Это нарушает исходные условия и может привести к неправильной записи. SSI решает эту проблему, отслеживая изменения и прерывая транзакции, которые основываются на устаревших данных.
2. **Обнаружение устаревших данных**: SSI использует **многоверсионное управление конкурентным доступом (MVCC)**, чтобы транзакция читала данные из согласованного снимка, игнорируя незафиксированные записи. При фиксации транзакции проверяется, не были ли изменены данные в промежутке, и если изменения были, транзакция прерывается.
3. **Обнаружение конфликтов записи**: При записи данных в базу система отслеживает, не были ли эти данные ранее прочитаны другой транзакцией. Если конфликт выявлен, транзакция прерывается. SSI использует индексы для отслеживания таких конфликтов, что позволяет эффективно управлять транзакциями.

**Производительность SSI**

Хотя SSI может быть медленнее, чем другие методы изоляции, она гораздо быстрее, чем традиционная сериализуемая изоляция, и достаточно эффективна, чтобы стать стандартом в будущем.

4o mini

---
Tags: #transactions #highLoad
Author: [[]]
Related: [[Сериализуемость]]
URL: -- 