## Идемпотентность запроса
aliases: 
	- "Идемпотентность запроса"

---
Идемпотентность запроса — это обеспечение возможности многократного вызова запроса с гарантией того, что состояние системы изменится только один раз.

Для обеспечения идемпотентности таких запросов нужно дополнительно контролировать на уровне API сервиса. Контроль включает в себя использование уникальных идентификаторов запросов (ключей идемпотентности) и логику обработки возможных конфликтов

![[Pasted image 20250205210114.png]]


 Предпочтительнее внедрить блок контроля идемпотентности между клиентом и контроллером с бизнес логикой, на уровне инфраструктуры:
 ![[Pasted image 20250205210155.png]]
### Обработка нового запроса
При поступлении нового запроса с уникальным ключом идемпотентности необходимо осуществить обработку, состоящую из следующих шагов:
1. Новый запрос с уникальным ключом идемпотентности требует сохранения соответствующей информации в хранилище данных.
2. Для предотвращения возможных конфликтов блокировка устанавливается на этапе обработки запроса. Она гарантирует, что операции будут выполнены последовательно и предотвращает параллельную обработку запросов с одним ключом идемпотентности.
3. Исполнение бизнес-логики контроллера.
4. По завершении исполнения запроса блок отвечает за сохранение ответа в хранилище данных. Это позволяет клиенту получить тот же результат при повторном запросе.
5. После сохранения ответа, блок освобождает блокировку, позволяя другим запросам с тем же ключом идемпотентности продолжить своё выполнение.

### Повторная обработка запроса
Обработка повторного запроса, состоит из следующих этапов:
1. Блок контроля идемпотентности проверяет наличие ключа из текущего запроса в хранилище данных.
2. Если ключ уже имеется в хранилище и связан с сохранённым ответом, то блок возвращает этот ответ, обозначая успешное завершение запроса.
3. Дальнейшая обработка запроса и выполнение бизнес-логики контроллера не происходят, поскольку запрос уже успешно обработан.
![[Pasted image 20250205210910.png]]

### Способы реализации:
#### Spring MVC
С помощью перехватчиков
 ![[Pasted image 20250205211339.png]]
 Пример базы данных для обеспечения идемпотентности запроса
 ![[Pasted image 20250205211517.png]]


 
 
---
Tags:  #idempotency
Author: [[]]
Related: [[Архитектурные паттерны]]
URL: https://habr.com/ru/companies/domclick/articles/779872/