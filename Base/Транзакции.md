## Что такое транзакция
aliases: 
	- "транзакция"

---

### Что такое транзакция

В информационных системах множество вещей может пойти не так:

- отказ базы данных, как аппаратный, так и программный, может случиться в любой момент, даже во время записи;
- приложение может аварийно завершиться посередине выполнения операций;
- сетевые разрывы могут нарушить связь между приложением и базой данных;
- несколько клиентов могут одновременно перезаписывать данные друг друга;
- клиент может получить некорректные данные из-за их частичного обновления;
- состояния гонки между клиентами могут привести к ошибкам.

Надежная система должна справляться с такими сбоями и предотвращать полные отказы. Транзакции давно считаются механизмом для решения этих проблем, группируя операции в единый блок, который либо выполняется целиком, либо откатывается. Это упрощает обработку ошибок, так как частичные отказы игнорируются.

Однако транзакции — это не закон природы, они были созданы для удобства программирования. В некоторых случаях лучше ослабить их гарантии или вовсе отказаться от них для повышения производительности. Чтобы понять, нужны ли транзакции, важно разобраться, какие гарантии безопасности они дают и каковы их затраты. 
Уровни изоляции:
- [[Слабые уровни изоляции]]
- [[Сериализуемость]]


Системы, не соответствующие [[ACID]] (атомарность, согласованность, изоляция, сохраняемость), иногда описывают термином BASE, обозначающим приблизительную доступность и конечную согласованность, что представляет собой более гибкий подход к отказоустойчивости и согласованности данных.




Транзакции — это абстракция, позволяющая приложению игнорировать проблемы конкурентного доступа и сбои в системе. Ошибки, такие как сбои процессов или отключения питания, часто сводятся к прерыванию транзакции, что позволяет повторить её выполнение. Для простых приложений с базовыми паттернами доступа транзакции могут быть излишними, но для более сложных сценариев они значительно снижают риск ошибок.

Без транзакций различные ошибки, включая сбои оборудования или проблемы с конкурентностью, могут привести к несогласованности данных. Например, денормализованные данные могут не соответствовать исходным значениям, и без транзакций сложно предсказать влияние на базу данных при сложных операциях.

Транзакции помогают предотвратить различные аномалии конкурентного доступа:

- **Грязные чтения** — когда один клиент читает данные, записанные другим, но ещё не зафиксированные. Это предотвращается изоляцией зафиксированных данных  ([[Read committed]]).
- **Грязные записи** — когда один клиент перезаписывает данные, записанные другим клиентом до их фиксации. Это предотвращают почти все реализации транзакций.
- **Невоспроизводимые чтения** — когда клиент видит разные данные в зависимости от времени чтения. Это устраняется с помощью изоляции снимков состояния (MVCC) ([[Изоляция снимков состояния и воспроизводимое чтение]]).
- **Потерянные обновления** — когда два клиента записывают изменения, перезаписывая данные друг друга. Это предотвращается изоляцией снимков состояния или блокировками (SELECT FOR UPDATE).
- **Асимметрия записи** — когда данные, на основе которых принималось решение, изменяются до выполнения транзакции. Это предотвращает только сериализуемость [[Сериализуемость]].
- **Фантомные чтения ([[Асимметрия записи и фантомы]])**  — когда транзакция читает данные, которые могут измениться в процессе работы. Это предотвращает изоляция снимков состояния, но для асимметрии записи необходимы дополнительные блокировки.

Слабые уровни изоляции могут предотвратить некоторые из этих проблем, но более сложные, как асимметрия записи или фантомные чтения, требуют ручной обработки. Только сериализуемая изоляция полностью решает эти проблемы. В этом контексте рассматриваются три подхода:

- **Последовательное выполнение транзакций**, эффективно работает при низкой нагрузке.
- **Двухфазная блокировка**, хотя и эффективна, снижает производительность.
- **Сериализуемая изоляция снимков состояния (SSI)** — оптимистичный подход, который выполняется без блокировок и прерывает несериализуемые транзакции до фиксации.

Хотя в главе были рассмотрены транзакции в реляционных базах, транзакции полезны в любых моделях данных, как показано в примере с многообъектными транзакциями. В распределённых системах транзакции сталкиваются с новыми вызовами, которые будут обсуждаться в следующих главах.


---
Tags: #transactions #highLoad
Author: [[]]
Related: [[Высоконагруженные приложения]]
URL: -- 