## Что такое транзакция
aliases: 
	- "транзакция"

---

### Что такое транзакция

В информационных системах множество вещей может пойти не так:

- отказ базы данных, как аппаратный, так и программный, может случиться в любой момент, даже во время записи;
- приложение может аварийно завершиться посередине выполнения операций;
- сетевые разрывы могут нарушить связь между приложением и базой данных;
- несколько клиентов могут одновременно перезаписывать данные друг друга;
- клиент может получить некорректные данные из-за их частичного обновления;
- состояния гонки между клиентами могут привести к ошибкам.

Надежная система должна справляться с такими сбоями и предотвращать полные отказы. Транзакции давно считаются механизмом для решения этих проблем, группируя операции в единый блок, который либо выполняется целиком, либо откатывается. Это упрощает обработку ошибок, так как частичные отказы игнорируются.

Однако транзакции — это не закон природы, они были созданы для удобства программирования. В некоторых случаях лучше ослабить их гарантии или вовсе отказаться от них для повышения производительности. Чтобы понять, нужны ли транзакции, важно разобраться, какие гарантии безопасности они дают и каковы их затраты. 
Уровни изоляции:
- [[Слабые уровни изоляции]]
- [[Сериализуемость]]


Системы, не соответствующие [[ACID]] (атомарность, согласованность, изоляция, сохраняемость), иногда описывают термином BASE, обозначающим приблизительную доступность и конечную согласованность, что представляет собой более гибкий подход к отказоустойчивости и согласованности данных.

### Резюме

Транзакции помогают предотвратить различные аномалии конкурентного доступа:

- **Грязные чтения** — когда один клиент читает данные, записанные другим, но ещё не зафиксированные. Это предотвращается изоляцией зафиксированных данных  ([[Read committed]]).
- **Грязные записи** — когда один клиент перезаписывает данные, записанные другим клиентом до их фиксации. Это предотвращают почти все реализации транзакций.
- **Невоспроизводимые чтения** — когда клиент видит разные данные в зависимости от времени чтения. Это устраняется с помощью изоляции снимков состояния (MVCC) ([[Изоляция снимков состояния и воспроизводимое чтение]]).
- **Потерянные обновления** ([[Предотвращение потери обновлений]])— когда два клиента записывают изменения, перезаписывая данные друг друга. Это предотвращается изоляцией снимков состояния  ([[Изоляция снимков состояния и воспроизводимое чтение]]) или блокировками (SELECT FOR UPDATE).
- **Асимметрия записи** — когда данные, на основе которых принималось решение, изменяются до выполнения транзакции. Это предотвращает только сериализуемость [[Сериализуемость]].
- **Фантомные чтения ([[Асимметрия записи и фантомы]])**  — когда транзакция читает данные, которые могут измениться в процессе работы. Это предотвращает изоляция снимков состояния, но для асимметрии записи необходимы дополнительные блокировки.

[[Слабые уровни изоляции]] могут предотвратить некоторые из этих проблем, но более сложные, как асимметрия записи или фантомные чтения, требуют ручной обработки. Только сериализуемая ([[Сериализуемость]]) изоляция полностью решает эти проблемы.

Хотя в главе были рассмотрены транзакции в реляционных базах, транзакции полезны в любых моделях данных, как показано в примере с многообъектными транзакциями. В распределённых системах транзакции сталкиваются с новыми вызовами, которые будут обсуждаться в следующих главах.


---
Tags: #transactions #highLoad
Author: [[]]
Related: [[Высоконагруженные приложения]]
URL: -- 