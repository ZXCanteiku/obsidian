## О чем эта заметка
aliases: 
	- "Сериализационные аномалии"

---

###  **Сериализационные аномалии (Serialization Anomalies)**

Хотя сам уровень называется Repeatable Read, PostgreSQL фактически обеспечивает более высокую изоляцию, близкую к Serializable, но не полностью её гарантирует. Сериализационные аномалии возникают, когда результат параллельных транзакций невозможно представить как их последовательное выполнение. Например:

- **Пример**:  
    Две транзакции одновременно читают данные, принимают решение на их основе и изменяют одни и те же строки, что приводит к противоречивому итоговому состоянию.
    
``` sql
-- Транзакция 1: Проверяет баланс и добавляет 100, если баланс > 0
BEGIN ISOLATION LEVEL REPEATABLE READ;
SELECT balance FROM accounts WHERE user_id = 1; -- Допустим, balance = 50
-- Транзакция 2: В это же время снимает 50
UPDATE accounts SET balance = balance - 50 WHERE user_id = 1;
COMMIT;

-- Транзакция 1 продолжает работу:
UPDATE accounts SET balance = balance + 100 WHERE user_id = 1;
COMMIT; 
-- Итоговый баланс: 100 (но ожидалось 50 - 50 + 100 = 100). 
-- В данном примере аномалии нет, но если бы логика была сложнее, могло возникнуть неочевидное поведение.
```

---
Tags: #db #isolation
Author: [[]]
Related: [[Уровни изоляций транзакции]]
URL: -- 