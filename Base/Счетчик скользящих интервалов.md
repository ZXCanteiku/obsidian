## Счетчик скользящих интервалов
aliases: 
	- "cчетчик скользящих интервалов"

---

# Счетчик скользящих интервалов

**Счетчик скользящих интервалов** — это **гибридный алгоритм**, сочетающий в себе два предыдущих метода **(фиксированных и скользящих интервалов)**. Его можно реализовать разными способами. Ниже рассмотрена одна из возможных реализаций.

### Как работает алгоритм?

На **рис. 4.11** показан пример работы алгоритма. Предположим, ограничитель трафика допускает **не более 7 запросов в минуту**.

- В **предыдущем интервале** было **5 запросов**.
- В **текущем интервале** уже **3 запроса**.
- На **отметке в 30%** от текущего интервала **количество запросов на скользящем интервале** вычисляется по следующей формуле:
    **Запросы на текущем интервале + (запросы на предыдущем интервале × процент предыдущего интервала, который занимает скользящий интервал)**
    _Подставляем значения:_
	    **3 + (5 × 0,7) = 6,5 запросов**.
    В зависимости от ситуации число можно **округлить** вверх или вниз. В нашем случае **округляется до 6**.
    - Так как ограничитель допускает **7 запросов в минуту**, **текущий запрос принимается**.
    - Однако, если поступит **еще один запрос**, **лимит будет исчерпан**.

### Иллюстрация работы алгоритма
![[Pasted image 20250301203424.png]]

## Преимущества и недостатки

### Преимущества

- **Сглаживание всплесков трафика** – частота запросов зависит от предыдущего интервала.
- **Экономия памяти** – не нужно хранить полный журнал всех запросов.

### Недостатки

- Работает **только для нежестких ретроспективных интервалов**.
- **Частота запросов получается приблизительной**, так как алгоритм предполагает **равномерное распределение** запросов в предыдущем интервале.

Однако это **не критично**: согласно **исследованию Cloudflare [10]**, среди **400 миллионов запросов** только **0,003%** были **ошибочно отклонены или приняты сверх квоты**.

---
Tags: #solution
Author: [[]]
Related: [[Rate limit]]
URL: -- 