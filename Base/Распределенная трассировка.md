## Распределенная трассировка
aliases: 
	- "Распределенная трассировка"

---
это паттерн, который позволяет **следить за запросами**, проходящими через **несколько микросервисов**.
Трейсы предоставляют полезную информацию, такую ​​как:
1. Путь запроса через распределенную систему.
2. Задержка запроса при каждой пересылке/вызове (например, от одного сервиса к другому).

### Составляющие трейса
Трейс представляет из себя древовидную структуру с родительским трейсом и дочерними спанами. Трейс запроса охватывает несколько сервисов и далее разбивается на более мелкие фрагменты по операциям/функциям, называемые спанами. Например, спан может охватывать вызов от одного микросервиса к другому. В рамках одного микросервиса может быть несколько спанов (в зависимости от того, сколько уровней классов/функций или зависимых микросервисов вызывается для обслуживания запроса).
![[Pasted image 20250205215651.png]]
Трассировка зиждется на создании уникального идентификатора для каждого запроса в точке входа и распространения его на последующие системы в качестве контекста трассировки в заголовках запросов. Это позволяет связать различную трассировочную информацию, исходящую от нескольких служб, в одном месте для анализа и визуализации.
**В итоге мы можем фильтровать логи**

### Способы реализации:
#### Инструментация с помощью сторонних решений, таких как DATADOG
Datadog по существу берет на себя заботу о централизованном логировании и сборе трассировочной информации.
![[Pasted image 20250205220033.png]]

#### ZIPKINS, CLOUD-SLEUTH СО SPRING BOOT
Преимущества:
1. Полная интеграция в SPRING boot
2. Простота в использовании
3. Трейсы можно визуализировать с помощью пользовательского интерфейса Zipkins.
4. Поддерживает стандарты OpenTracing через внешние библиотеки.
5. Поддерживает корреляцию логов через контексты Log4j2 MDC.

Недостатки:
1. Нет решения для автоматического сбора логов, связанных с трейсами. Нам придется самостоятельно отправлять логи в ElasticSearch и выполнять поиск, используя идентификаторы трейсов, сгенерированные cloud-sleuth (как заголовок X-B3-TraceId).
![[Pasted image 20250205220225.png]]

#### AMAZON XRAY
Преимущества:
1. Нативно поддерживает все ресурсы AWS, что очень хорошо, если ваши распределенные сервисы развернуты и работают в AWS
2. Балансировщики нагрузки AWS автоматически генерируют идентификаторы (REQUEST ID) для каждого входящего запроса, что освобождает приложение от этой заботы. ([Ссылка](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-request-tracing.html))
3. Позволяет выполнять трассировку на всем пути от шлюза API до балансировщика нагрузки, сервиса и других зависимых ресурсов AWS.
4. Реализует корреляцию логов с помощью логов в CLOUDWATCH logs

Недостатки
1. Cloudwatch log может стать очень дорогими при большом объеме логов
#### JAGER
Преимущества:
1. Поддерживает opentracing по умолчанию
2. Имеет библиотеки, которые работают со Spring
3. Поддерживает Jager Agent, который можно установить в качестве средства распространения трейсов и логов.

Недостатки:
1. С точки зрения обслуживания и настройки инфраструктуры достаточно сложен.


---
Tags:  #tracing
Author: [[]]
Related: [[Распространённые решения]]
URL: https://habr.com/ru/companies/otus/articles/538984/