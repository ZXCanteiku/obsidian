## Обнаружение связей тип Происходит до
aliases: 
	- "обнаружение связей тип Происходит до"

---

### Обнаружение связей тип Происходит до

Алгоритм для определения, являются ли две операции конкурентными или одна произошла до другой, можно объяснить на примере базы данных с одной репликой.

На рисунке два клиента одновременно добавляют товары в корзину. Сначала корзина пуста. Клиенты делают пять записей:

1. Клиент 1 добавляет молоко. Сервер присваивает записи версию 1 и возвращает её клиенту.
2. Клиент 2 добавляет яйца, не зная о записи клиента 1. Сервер присваивает записи версию 2, хранит оба товара (молоко и яйца) и возвращает их клиенту.
3. Клиент 1 добавляет муку, основываясь на версии 1, думая, что текущее содержимое корзины — [молоко, мука]. Сервер присваивает этой записи версию 3, перезаписывая молоко, но сохраняя яйца.
4. Клиент 2 добавляет ветчину, основываясь на версии 2, создавая новое значение [яйца, молоко, ветчина] и получает версию 4.
5. Клиент 1 добавляет бекон, объединяя предыдущие данные с версией 3. Получается [молоко, мука, яйца, бекон], сохраняется с версией 5.

![[Pasted image 20241010211755.png]]

Данные на сервере отображены графически на рисунке 2, где видно, как операции ссылаются на предыдущие или происходят параллельно. В этом примере сервер определяет конкурентные операции по номерам версий и не теряет данные.
![[Pasted image 20241010211806.png]]

Алгоритм работает так:

- Сервер присваивает ключам версии при каждом обновлении.
- При чтении возвращаются все актуальные значения и последний номер версии.
- Клиент отправляет на сервер данные с предыдущей версией, указывая, на каком состоянии они основаны.
- Сервер обновляет только старые версии, а более новые значения сохраняет, если они конкурентны.


---
Tags: #highLoad #develop #replication
Author: [[]]
Related: [[Обнаружение конкурентных операций записи]]
URL: -- 