## Материализацию конфликтов
aliases: 
	- "материализацию конфликтов"

---

### Материализацию конфликтов

Раз уж проблема с фантомами заключается в отсутствии объекта, на который можно было бы установить блокировку, вероятно, имеет смысл искусственно создать объект для блокировки в базе данных? Например, в случае с бронированием конференц-залов можно было бы создать таблицу отрезков времени и залов. Каждая строка в ней соответствовала бы конкретному залу на определенный период времени (допустим, 15 минут). Можно было бы создать строки для всех вероятных сочетаний залов и отрезков времени заранее, например, на следующие шесть месяцев. Тогда транзакция перед созданием бронирования могла бы блокировать (SELECT FOR UPDATE) строки в этой таблице, соответствующие нужным залу и отрезку времени. После установки блокировок можно проверить пересечения операций бронирования и вставить новую бронь, как и раньше. Обратите внимание: сама дополнительная таблица не служит для хранения информации о бронировании — это просто набор блокировок, используемый для предотвращения конкурентного изменения бронирования одного и того же зала на одно время.
Такой подход с превращением фантома в конфликт при блокировке на конкретном множестве существующих в БД строк носит название материализации конфликтов (materializing conflicts) [11]. К сожалению, материализация конфликтов непроста и подвержена ошибкам, а перетекание механизма управления конкурентным доступом в модель данных приложения выглядит не очень красиво. Поэтому материализацию конфликтов следует рассматривать как последнее средство, если нет никаких альтернатив. В большинстве случаев предпочтительнее использовать изоляцию уровня сериализуемости.

---
Tags: #transactions #highLoad
Author: [[]]
Related: [[Асимметрия записи и фантомы]]
URL: -- 