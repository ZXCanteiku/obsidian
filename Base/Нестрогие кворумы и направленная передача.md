## О чем эта заметка
aliases: 
	- "нестрогие кворумы и направленная передача"

---

### Что такое нестрогие кворумы и направленная передача

Нестрогие кворумы обеспечивают большую гибкость и доступность в распределённых системах, но они менее надёжны в плане согласованности данных по сравнению с традиционными строгими кворумами.

Когда вы используете строгий кворум (_w + r > n_), чтения и записи должны пересекаться хотя бы на одном узле, что обычно гарантирует возврат самого актуального значения. Однако нестрогий кворум позволяет системе работать даже при сбоях в сети или отказах узлов, жертвуя при этом частичной согласованностью.

### Основная идея нестрогого кворума

При нестрогом кворуме запросы могут отправляться и обрабатываться не только на "домашних" узлах, предназначенных для хранения определённых данных, но и на любых других доступных узлах в кластере, если "домашние" узлы недоступны. Это даёт возможность продолжать операции записи и чтения даже в условиях сетевых разрывов или отказов узлов, обеспечивая высокую доступность.

Если, например, происходит разрыв сети и клиент теряет доступ к большинству "домашних" узлов, система может записывать данные на другие узлы. Когда проблема будет устранена, данные, записанные на этих узлах, будут отправлены на "домашние" узлы — этот процесс называется _направленной передачей_ (_hinted handoff_). Таким образом, данные "возвращаются" на свои узлы, когда они снова становятся доступными.

#### Проблемы с нестрогим кворумом

1. **Нет гарантии согласованности:** Даже если _w + r > n_, это не гарантирует, что вы прочтёте последнее значение, так как оно могло быть временно записано на узлы, не входящие в набор из _n_ реплик, и данные могут ещё не быть переданы обратно на "домашние" узлы.
    
2. **Задержка синхронизации:** После устранения сбоя может потребоваться время для передачи данных с временных узлов на "домашние", что может привести к устаревшим данным на чтении до завершения этой синхронизации.
    
3. **Низкая согласованность при высоких отказах:** Если большинство узлов системы недоступны, могут возникать конфликты данных, требующие разрешения. Например, разные узлы могут содержать разные версии данных, и системе потребуется либо разрешить конфликт, либо решить, какая версия данных является "правильной".
    

#### Преимущества

Основное преимущество нестрогого кворума — высокая доступность. Пока доступны хотя бы _w_ узлов для записи, база данных продолжит принимать записи. Это делает систему более устойчивой к сетевым разрывам и сбоям узлов.

#### Применение

Нестрогие кворумы активно используются в системах с репликацией без ведущего узла (например, в Dynamo-подобных системах). Такие кворумы включены по умолчанию в Riak, а в Cassandra и Voldemort они могут быть включены при необходимости.

Таким образом, нестрогие кворумы — это компромисс между высокой доступностью и потенциальной потерей согласованности. Они подходят для приложений, которые могут терпеть некоторое количество устаревших данных ради поддержания доступности даже в случае сбоев.

---
Tags: #highLoad #develop #replication
Author: [[]]
Related: [[Репликация без ведущего узла]]
URL: -- 