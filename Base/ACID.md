## ACID
aliases: 
	- "ACID"

Требования, для наиболее эфективной и безопасной работы транзакций.

**Атомарность (atomicity)** гарантирует, что никакая транзакция не будет зафиксирована в системе частично. Будут либо выполнены все её подоперации, либо не выполнено ни одной.

**Согласованность (consistency)** требование, подразумевающее, что в результате работы транзакции данные будут допустимыми. Это вопрос не технологии, а бизнес-логики: например, если количество денег на счете не может быть отрицательным, логика транзакции должна проверять, не выйдет ли в результате отрицательных значений.

**Изолированность (isolation)**. Во время выполнения транзакции параллельные транзакции не должны оказывать влияние на её результат.
![[Pasted image 20241113201413.png]]

**Долговечность (durability)**. Независимо от проблем на нижних уровнях изменения, сделанные успешно завершённой транзакцией, должны остаться сохранёнными после возвращения системы в работу. Другими словами, если пользователь получил подтверждение от системы, что транзакция выполнена, он может быть уверен, что сделанные им изменения не будут отменены из-за какого-либо сбоя.

---------

В ACID-системах атомарность и изоляция транзакций определяют, как база данных обрабатывает несколько операций записи.

**Атомарность** гарантирует, что при ошибке транзакция прерывается, и все выполненные до того момента изменения отменяются, обеспечивая принцип "все или ничего".

**Изоляция** предотвращает конфликты между транзакциями. Если одна транзакция изменяет данные, то другая видит либо все изменения, либо ничего — исключая промежуточные состояния.

Эти свойства важны, когда нужно одновременно изменять несколько объектов (строк, документов). Например, при показе пользователю непрочитанных сообщений можно денормализовать данные, добавив счетчик таких сообщений. Это повышает скорость обработки, но требует, чтобы при обновлении сообщения обновлялся и счетчик. Без изоляции возможна ошибка, когда пользователь видит новое сообщение, а счетчик не обновился. Изоляция решает эту проблему, обеспечивая согласованность состояния (рис. 7.2).
![[Pasted image 20241113202045.png]]

При ошибках во время транзакции атомарность помогает избежать несогласованности: если не удается обновить счетчик, откатываются и изменения сообщения (рис. 7.3). В реляционных БД транзакции группируются на уровне соединения (между `BEGIN TRANSACTION` и `COMMIT`). Однако не все базы данных, например, некоторые нереляционные, поддерживают такую транзакционность, что может привести к частичным обновлениям.
![[Pasted image 20241113202054.png]]

### Однообъектные операции записи

Атомарность и изоляция важны и для операций с отдельными объектами. Например, при записи JSON-документа важно, чтобы при ошибке (например, разрыве соединения) документ был либо полностью сохранен, либо отклонен. Большинство баз данных гарантирует атомарность на уровне объекта, предотвращая появление некорректных данных, используя журналы и блокировки.

### Важность многообъектных транзакций

Хотя некоторые системы отказываются от поддержки многообъектных транзакций из-за сложности их реализации, они остаются важными для поддержания целостности данных. Например, ссылки между строками в реляционной базе или согласованность денормализованных данных требуют многообъектных транзакций для предотвращения расхождений.

### Обработка ошибок и прерывание транзакций

ACID-системы позволяют безопасно прерывать транзакции и повторять их при ошибках, гарантируя надежность данных. Однако не все системы придерживаются этого подхода: некоторые, например базы данных с репликацией без ведущего узла, при ошибках продолжают работать с частично выполненными данными. Это усложняет восстановление, перекладывая ответственность за ошибки на приложение.

Часто ORM-фреймворки, такие как ActiveRecord и Django, не поддерживают автоматическое повторное выполнение прерванных транзакций, что приводит к потерям данных. Для надежности транзакции должны прерываться и повторяться в случае сбоя, что снижает вероятность ошибок и увеличивает устойчивость системы.

---
Tags: #acid #db
Author: [[]]
Related: [[Реляционные базы данных]]
URL: [[]]